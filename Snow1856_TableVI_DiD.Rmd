---
title: "John Snow Project - 1856 Table VI and DiD Extension"
author: "[Thomas Coleman](http://www.hilerun.org/econ)"
output: html_notebook
---
# Examining Snow's 1856 Table VI - Predicted Mortality and Diff-in-Diffs with Population Data

#### See "Causality in the Time of Cholera" working paper at https://papers.ssrn.com/abstract=3262234 and my [John Snow project website](http://www.hilerun.org/econ/papers/snow)

#### This notebook is licensed under the [BSD 2-Clause License](https://opensource.org/licenses/BSD-2-Clause)

### Introduction

This notebook extends the analysis for Table VI from Snow's 1856 "Cholera and the water supply ..." using a difference-in-differences framework. This notebook builds on the ideas in the notebook "Snow1856_TableVI_Intro" but is stand-alone can be run separately. 

With population data by sub-district and by water supply company (originally published in Simon 1856, "Report on the last two cholera-epidemics of London"), Snow was able to compare mortality at the sub-district level more closely than he could in his 1855 "On the mode of communication ...". In Table VI Snow used estimates of mortality rates for Southwark & Vauxhall versus Lambeth, combined with population fractions by sub-district, to calculate population-weighted predicted mortality by sub-district. Snow's goal was to show that differences in water supply was the predominant factor - more important than crowding or other factors - in accounting for differences across sub-districts. 

Snow, however, did not have the statistical tools and methodology available to us today, and his argument had neither the clarity nor the rigor we would demand today. This notebook uses a more appropriate statistical approach: regression that uses the population by sub-district and water company to simultaneously estimate and test differences across the water companies (and across time). The conclusion (not surprisingly) overwhelmingly supports Snow's contention that dirty versus clean water is the most important factor in accounting for differences across sub-districts (and across time). As a digression I examine earlier efforts in the literature to address and extend Snow's Table VI, discussing why those efforts fall short. 


For a brief introduction to Snow's work, see:

+ **Snow's original 1855 monograph** (it is masterful): Snow, John. 1855. *On the Mode of Communication of Cholera*. 2nd ed. London: John Churchill. http://archive.org/details/b28985266.
+ **The best popular exposition I have found**: Johnson, Steven. 2007. *The Ghost Map: The Story of Londonâ€™s Most Terrifying Epidemic--and How It Changed Science, Cities, and the Modern World*. Reprint edition. New York: Riverhead Books.
+ **Another good popular version**: Hempel, Sandra. 2007. *The Strange Case of the Broad Street Pump: John Snow and the Mystery of Cholera*. First edition. Berkeley: University of California Press.
+ **Tufte's classic discussion of Snow's mapping** (a topic I don't cover here): Tufte, Edward R. 1997. *Visual Explanations: Images and Quantities, Evidence and Narrative*. 1st edition. Graphics Press.
+ **Biography**: Vinten-Johansen, Peter, Howard Brody, Nigel Paneth, Stephen Rachman, and Michael Russell Rip. 2003. *Cholera, Chloroform and the Science of Medicine: A Life of John Snow*. Oxford; New York: Oxford University Press. Linked on-line resources https://johnsnow.matrix.msu.edu/snowworks.php




This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. The results are also saved in a self-contained html document with the suffix *.nb.html*. If you want pure r code (for example to run outside RStudio) you can easily extract code with the command *knit('notebook.Rmd',tangle=TRUE)* which will save a file 'notebook.R' under your working directory.

Try executing the chunk below by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

``````{r message=FALSE, results='hide'}
rm(list=ls())    # starts a fresh workspace
#
library(knitr)
options(scipen=5)
# The following libraries are used for the Negative Binomial regression and the robust standard error analysis
#install.packages("sandwich")
#install.packages("lmtest")
library("MASS")
library("sandwich") 
library("lmtest") 

# Read in the data from Snow 1855 "On the mode of communication of cholera"
tableviii <- read.csv(file="Snow1855_TableVIII.csv", header=TRUE, sep=",", skip=5,comment.char="#")
tablexii <- read.csv(file="Snow1855_TableXII.csv", header=TRUE, sep=",", skip=5,comment.char="#")

# Read in the data from John Snow 1856, "Cholera and the water supply in the south district of London in 1854", 
#   These data were copied from the 1936 book "Snow on cholera, being a reprint of two papers" edited by Frost
# Table V by District (for running Poisson & Neg Binomial count regressions)
# Table VI by sub-district (for running Koch & Denike's tests)

# Table I "Showing the results of the Author's personal Inquiry into Twenty-One Sub-Districts"
# Table II "Showing the results of Inquiry made by Mr. Whiting in Eleven Sub-Districts"
# (My "tablei_1856" combines Snow's Tables I & II)

tablei_1856 <- read.csv(file="Snow1856_TableI.csv",
  header=TRUE, sep=",", skip=5,comment.char="#")

tableV_1856 <- read.csv(file="Snow1856_TableV.csv",
  header=TRUE, sep=",", skip=5,comment.char="#")
tableVI_1856 <- read.csv(file="Snow1856_TableVI.csv",
  header=TRUE, sep=",", skip=5,comment.char="#")


```


###Difference-in-Differences Regression with Population Weights

####Setting the Scene

In Snow 1856 we have estimated houses and estimated population assigned to the two water supply companies. But there are actually *three* sources of water: Southwark & Vauxhall Co, Lambeth Co, and "Other" (pump-wells, Thames, ditches). There is considerable variation across sub-districts not only in the proportion supplied by Southwark versus Lambeth, but also in the total proportion supplied by water companies versus "other". 


```{r}
tablei_1856$combined_pop <- tablei_1856$southwark_pop + tablei_1856$lambeth_pop
tablei_1856[c("subDistrict","pop1851","southwark_pop","lambeth_pop","combined_pop")]
```

The estimates published in Snow 1856 Tables I and II (displayed above) show that for St. Saviour, Southwark `r round(100 * tablei_1856$southwark_pop[1] / tablei_1856$pop1851[1],1)`% was supplied by the Southwark water company, `r round(100 * tablei_1856$lambeth_pop[1] / tablei_1856$pop1851[1],1)`% by Lambeth, and `r round(100 * tablei_1856$combined_pop[1] / tablei_1856$pop1851[1],1)`% by the two combined. For St. Mary, Newington `r round(100 * tablei_1856$southwark_pop[19] / tablei_1856$pop1851[19],1)`% was supplied by the Southwark Company, `r round(100 * tablei_1856$lambeth_pop[19] / tablei_1856$pop1851[19],1)`% by Lambeth, and only `r round(100 * tablei_1856$combined_pop[19] / tablei_1856$pop1851[19],1)`% by the two combined. 

Note in passing that there are problems with the population estimates (which Snow highlighted). Some sub-districts that were in fact not supplied by the Lambeth Company (such as St. Saviour, Southwark) have incorrectly-reported Lambeth population. Some sub-districts (such as St. Mary Magdalen) have a larger combine Southwark + Lambeth population than the 1851 census population.

To account for the variation in observed sub-district mortality we need to measure the population differences for all three sources; Snow in Table VI only accounted for the first two. To do this we can model the mortality rate for a sub-district as the population-weighted average:

$R_{subdis,yr} = R_S * P_S + R_L^{54} * P_L * I_{yr=1854} + R_L * P_L + R_O * P_O + \delta_{54} * I_{yr=1854} + \epsilon$

+ $R_S ...$ = (estimated) mortality rate for Southwark, Lambeth, Other
+ $P_S ...$ = (observed) population proportion for Southwark, Lambeth, Other
+ $R_L^{54}$ = (estimated) Lambeth 1854 effect (clean water treatment effect)

To highlight and more easily test the difference between Southwark and Lambeth we can note that $P_S = 1 - P_L - P_O$, use $R_S$ as the overall constant, and write

$R_{subdis,yr} = R_S + (R_L^{54}-R_S) * P_L * I_{yr=1854} + (R_L-R_S) * P_L + (R_O-R_S) * P_O + \delta_{54} * I_{yr=1854} + \epsilon$

so that the estimated coefficients ($(R_L-R_S)$) are the difference from the excluded (Southwark) category. 

####Creating the Data

Just as for the notebook "Snow1855_DiDRegression1" we must stack the data from Snow 1855 Tables VIII and XII and create appropriate indicator variables. Here we also need to merge in the population estimates from Snow 1856 Tables I & II.

```{r}
x1 <- subset(tableviii,supplier == "SouthwarkVauxhall" | supplier == "SouthwarkVauxhall_Lambeth")
x1849 <- x1[c("subDistrict","pop1851","supplier","lambethdegree")]
x1 <- subset(tablexii,supplier == "SouthwarkVauxhall" | supplier == "SouthwarkVauxhall_Lambeth")
x1849$deaths <- x1$deaths1849
x1849$rate <- 10000 * x1$deaths1849 / x1849$pop1851
x1849$seq <- c(seq(1,length(x1849$deaths)))
#x1849$dum1854 <- 0
xyear <- factor(c(rep(1849,28),rep(1854,28)))
x1849$year <- xyear[1:28]
x1854 <- x1849
#x1849$lambethdegree <- "dirty"
x1854$deaths <- x1$deaths1854
x1854$rate <- 10000 * x1$deaths1854 / x1849$pop1851
x1854$seq <- c(seq(1,length(x1849$deaths)))
#x1854$dum1854 <- 1
x1854$year <- xyear[29:56]


# First, re-generate "redgata" after pasting on population fractions. 
# For 1849 and for Southwark-only sub-districts 

# Lambeth population as percent of total (1851) population. Zero out the non-Lambeth sub-districts ("first 12")
# I want three variables:
#  1) Lambeth for both 1849 & 1854 
#  2) Other for both 1849 & 1854
# these two will measure against Southwark for dirty water
#  3) Lambeth for 1854   -  this should measure Lambeth for clean water
x1849$otherperc <- 0
x1854$otherperc <- 0
x1849$lambethperc <- 0
x1854$lambethperc <- 0
x1849$lambethperc54 <- 0
x1854$lambethperc54 <- 0
# This calculates lambeth as percent of TOTAL population. I think this is right for
# measuring the "Lambeth effect" because it gives the proportion of the population treated (with clean Lambeth water)
# which is the variation from 1849 to 1854
x1849$otherperc <- 1 - (tablei_1856[1:28,]$southwark_pop + tablei_1856[1:28,]$lambeth_pop ) /
	tablei_1856[1:28,]$pop1851
x1854$otherperc <- x1849$otherperc
# Variable for only 1954 Lambeth
x1854[13:28,]$lambethperc54 <- tablei_1856[13:28,]$lambeth_pop / tablei_1856[13:28,]$pop1851
x1849$lambethperc <- x1854$lambethperc54
x1854$lambethperc <- x1849$lambethperc

# population per house seems to come in as factor - convert to numeric
x1849$pop_per_house <- as.numeric(as.character(tablei_1856$pop_per_house[1:28]))
x1854$pop_per_house <- as.numeric(as.character(tablei_1856$pop_per_house[1:28]))

regdata <- rbind(x1849,x1854)

regdata
```

####OLS Linear Regressions

With the dataframe "regdata" we can now run various regressions. To start just the simple OLS linear regression.

```{r}
# Linear with no population density
linpopn <- lm(regdata$rate ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year )
linpopnrobustse <- coeftest(linpopn, vcov = vcovHC(linpopn))
summary(linpopn)

```

The "Lambeth" or clean water effect is the coefficient "`r labels(linpopn$coefficients[2])`" = `r round(summary(linpopn)$coefficients[2,1],1)` - the mortality per 10,000 for Lambeth company customers, as a difference from Southwark & Vauxhall company customers. The z value of `r round(summary(linpopn)$coefficients[2,3],1)` indicates that this is statistically significant. The value itself is very large, telling us that in 1854 the mortality rate of Lambeth customers was `r round(summary(linpopn)$coefficients[2,1],0)` per 10,000 lower than for Southwark & Vauxhall customers - a *very* large difference given that the base Southwark & Vauxhall mortality was `r round(summary(linpopn)$coefficients[1,1],0)`.

The adjusted R-squared tests whether variations in the population proportions and differences in water supply account for much of the observed variation in mortality, exactly what Snow was trying to test. The high R-squared shows that indeed differences in mortality between water suppliers accounts for much of the observed variation. 

The population estimates published in 1856 also included housing density estimates. One popular and very reasonable hypothesis was that crowding led to higher cholera mortality. We can test the effect of differences in crowding, within this region of south London, by including housing density as a regressor. 

```{r}
# Linear with population density
linpopn_den <- lm(regdata$rate ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	+ regdata$pop_per_house )
linpopn_denrobustse <- coeftest(linpopn_den, vcov = vcovHC(linpopn_den))
summary(linpopn_den)

```


Doing so has virtually effect on the Lambeth coefficient - it is still `r round(summary(linpopn_den)$coefficients[2,1],1)`. Housing density is marginally significant but adds little to the overall explanatory power of the regression - the Adjusted R-Squared increases from `r round(summary(linpopn)$adj.r.squared,3)` to `r round(summary(linpopn_den)$adj.r.squared,3)`.

We can also include fixed effects for each sub-district. Including housing density asks "does the difference in density across sub-districts help explain mortality, or reduce the importance of clean water for Lambeth customers?" Including fixed effects asks a dramatically more general question: "are there any differences across sub-districts that help explain mortality or reduce the importance of clean water?" The answer is basically "No". 

```{r}
# Linear with fixed effects
linpopn_FE <- lm(regdata$rate ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	+ regdata$subDistrict )
linpopn_FErobustse <- coeftest(linpopn_FE, vcov = vcovHC(linpopn_FE))
summary(linpopn_FE)

```

The Adjusted R-Squared increases from `r round(summary(linpopn)$adj.r.squared,3)` to `r round(summary(linpopn_FE)$adj.r.squared,3)`, but the value of the Lambeth effect is unchanged and in fact is now estimated even more precisely: t value `r round(summary(linpopn_FE)$coefficients[2,3],1)`. Yes there are differences in mortality across sub-districts that are not explained only by differences in water supplier, but water supply still has a dramatically large and precisely-estimated effect. 

####Count (Poisson & Negative Binomial Regressions)

The OLS regression above is not really appropriate because observed variables are counts - positive and integer-valued rather than continuous. The residuals for the regression cannot be continuous normal variables. We need to turn to Poisson or Negative Binomial regression. Unfortunately the standard estimation routines are based on a logarithmic relation:

$ln(R_{subdis,yr}) = R_S + (R_L^{54}-R_S) * P_L * I_{yr=1854} + (R_L-R_S) * P_L + (R_O-R_S) * P_O + \delta_{54} * I_{yr=1854} + \epsilon$

It is thus difficult to impose exactly the linear relation between the rate and the population fractions. (We would need a non-linear Poisson and Negative Binomial fitting routine.) In spite of this we can run the count regressions and we find essentially the same as the linear regressions: water supply is dramatically important and the effect on mortality dramatically large. 

The following code chunk runs a variety of Poisson and Negative Binomial regressions but displays only the Negative Binomial with housing density. 

```{r}
# Poisson with no FE and no housing density
pois1popn <- glm(regdata$deaths ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	+ offset(log(regdata$pop1851)), family=poisson)
pois1popnrobustse <- coeftest(pois1popn, vcov = vcovHC(pois1popn))
#summary(pois1popn)
#logLik(pois1popn)
#coeftest(pois1popn, vcov = vcovHC(pois1popn))

# Poisson with housing density
pois1popn_den <- glm(regdata$deaths ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	+ regdata$pop_per_house	+ offset(log(regdata$pop1851)), family=poisson)
pois1popn_denrobustse <- coeftest(pois1popn_den, vcov = vcovHC(pois1popn_den))
#summary(pois1popn_den)
#logLik(pois1popn_den)
#coeftest(pois1popn_den, vcov = vcovHC(pois1popn_den))

# Poisson with different rates by sub-district (fixed effects)
pois2popn <- glm(regdata$deaths ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	+ regdata$subDistrict + offset(log(regdata$pop1851)), family=poisson)
pois2popnrobustse <- coeftest(pois2popn, vcov = vcovHC(pois2popn))
#summary(pois2popn)
#logLik(pois2popn)
#coeftest(pois2popn, vcov = vcovHC(pois2popn))



# Negative Binomial with no FE and no housing density
nb1popn <- glm.nb(regdata$deaths ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	 + offset(log(regdata$pop1851)))
nb1popnrobustse <- coeftest(nb1popn, vcov = vcovHC(nb1popn))
#summary(nb1popn)
#logLik(nb1popn)
#coeftest(nb1popn, vcov = vcovHC(nb1popn))


# Also run with housing density
nb1popn_den <- glm.nb(regdata$deaths ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	+ regdata$pop_per_house + offset(log(regdata$pop1851)))
nb1popn_denrobustse <- coeftest(nb1popn_den, vcov = vcovHC(nb1popn_den))
#summary(nb1popn_den)
#logLik(nb1popn_den)
#coeftest(nb1popn_den, vcov = vcovHC(nb1popn_den))

# Finally, FEs
nb2popn <- glm.nb(regdata$deaths ~ regdata$lambethperc54 + regdata$lambethperc + regdata$otherperc + regdata$year
	+ regdata$subDistrict + offset(log(regdata$pop1851)))
nb2popnrobustse <- coeftest(nb2popn, vcov = vcovHC(nb2popn))
#summary(nb2popn)
#logLik(nb2popn)
#coeftest(nb2popn, vcov = vcovHC(nb2popn))

summary(nb1popn_den)

```

The result for the Negative Binomial with housing density is, again, that the effect of clean water (the Lambeth effect) is large and statistically significant (coefficient `r round(summary(nb1popn_den)$coefficients[2,1],3)`, ratio effect `r round(exp(-summary(nb1popn_den)$coefficients[2,1]),2)`, z ratio `r round(summary(nb1popn_den)$coefficients[2,3],2)`). The regression fits the data reasonably well when measured by the Residual Deviance. 

####Populating Table with Summary Statistics

I use these tables to summarize the diff-in-diff regressions, but do not display them here. You can if you wish. 

First, a code chunk for the linear regressions (but also including the Negative Binomial with population density)


```{r}
# Create table with regression results (diff-in-diffs estimate) using robust SEs
# for all except the NB1 (Negative Binomial without sub-district fixed effects)
regtabledid1856lin <- matrix(0,nrow=13,ncol=4)
colnames(regtabledid1856lin) <- c("Lin","Lin popden","Lin FE","NB popden")
rownames(regtabledid1856lin) <- c("Lambeth 1854 effect","SE","z value","p-value",
	"lambeth perc","z value","other perc","z value",
	"pop density","z value","Rsq / resid dev",	"Southwark 1854 rate","Lambeth 1854 rate")
# Populate the table from the regressions
# Linear no population density
regtabledid1856lin[c(1,2,3,4),1] <- summary(linpopn)$coefficients[2,c(1,2,3,4)]
regtabledid1856lin[11,1] <- summary(linpopn)$adj.r.squared
regtabledid1856lin[c(5,6),1] <- summary(linpopn)$coefficients[3,c(1,3)]
regtabledid1856lin[c(7,8),1] <- summary(linpopn)$coefficients[4,c(1,3)]
regtabledid1856lin[c(12,13),1] <- c(sum(summary(linpopn)$coefficients[c(1,5)]),sum(summary(linpopn)$coefficients[c(1,2,3,5)]))
# Linear Population density
regtabledid1856lin[c(1,2,3,4),2] <- summary(linpopn_den)$coefficients[2,c(1,2,3,4)]
regtabledid1856lin[11,2] <- summary(linpopn_den)$adj.r.squared
regtabledid1856lin[c(5,6),2] <- summary(linpopn_den)$coefficients[3,c(1,3)]
regtabledid1856lin[c(7,8),2] <- summary(linpopn_den)$coefficients[4,c(1,3)]
regtabledid1856lin[c(9,10),2] <- summary(linpopn_den)$coefficients[6,c(1,3)]
regtabledid1856lin[c(12,13),2] <- c(sum(summary(linpopn_den)$coefficients[c(1,5)]),sum(summary(linpopn_den)$coefficients[c(1,2,3,5)]))
# Linear Fixed Effects
regtabledid1856lin[c(1,2,3,4),3] <- summary(linpopn_FE)$coefficients[2,c(1,2,3,4)]
regtabledid1856lin[11,3] <- summary(linpopn_FE)$adj.r.squared
regtabledid1856lin[c(5,6),3] <- summary(linpopn_FE)$coefficients[3,c(1,3)]
regtabledid1856lin[c(7,8),3] <- summary(linpopn_FE)$coefficients[4,c(1,3)]
regtabledid1856lin[c(12,13),3] <- c(sum(summary(linpopn_FE)$coefficients[c(1,5)]),sum(summary(linpopn_FE)$coefficients[c(1,2,3,5)]))
# Negative Binomial population density
regtabledid1856lin[c(1,2,3,4),4] <- summary(nb1popn_den)$coefficients[2,c(1,2,3,4)]
regtabledid1856lin[c(9,10),4] <- summary(nb1popn_den)$coefficients[6,c(1,3)]
regtabledid1856lin[11,4] <- summary(nb1popn_den)$deviance
regtabledid1856lin[c(5,6),4] <- summary(nb1popn_den)$coefficients[3,c(1,3)]
regtabledid1856lin[c(7,8),4] <- summary(nb1popn_den)$coefficients[4,c(1,3)]
#regtabledid1856lin[12,4] <- 10000 * sum(nb1popn_den$fitted.values[29:40]) / sum(regdata$pop1851[29:40])
#regtabledid1856lin[13,4] <- 10000 * sum(nb1popn_den$fitted.values[41:56]) / sum(regdata$pop1851[41:56])
regtabledid1856lin[c(12,13),4] <- 10000 * c(exp(sum(summary(nb1popn_den)$coefficients[c(1,5)])),
	exp(sum(summary(nb1popn_den)$coefficients[c(1,2,3,5)])))

kable(regtabledid1856lin[c(1,3,9,10),c(2,4)],digits=3, caption = "Summary - Diff-in-Diffs Comparison Using Population Proportions",format='pandoc')


```

Then a code chunk for the various permutations of count regressions with population proportions, six regressions in total:

+ Poisson and Negative Binomial
+ For each, no population density, yes population density, sub-district fixed effects.

```{r}
# Copyright (c) 2019, Thomas Coleman
#
#  -------  Licensed under BSD 2-Clause "Simplified" License  -------
#
# Results and discussion in "Causality in the Time of Cholera: John Snow as a Prototype 
# for Causal Inference (Working Paper)" available at SSRN: https://papers.ssrn.com/abstract=3262234

# Create table with regression results (diff-in-diffs estimate) using robust SEs
# for all except the NB1 (Negative Binomial without sub-district fixed effects)
regtabledid1856 <- matrix(0,nrow=21,ncol=6)
colnames(regtabledid1856) <- c("Poiss","Poiss pop","PoissFE","NB","NB pop","NB FE")
rownames(regtabledid1856) <- c("Lambeth 1854 effect","SE","z value","p-value",
	"robust SE","z value","ratio effect",
	"lambeth perc","SE","z value","p-value","other perc","SE","z value","p-value",
	"theta","resid dev","pop den","SE","z value","p-value")
# Populate the table from the regressions
# Poiss no population density
regtabledid1856[c(1,2,3,4),1] <- summary(pois1popn)$coefficients[2,c(1,2,3,4)]
regtabledid1856[c(5,6),1] <- pois1popnrobustse[2,c(2,3)]
regtabledid1856[7,1] <- exp(regtabledid1856[1,1])
regtabledid1856[c(8,9,10,11),1] <- summary(pois1popn)$coefficients[3,c(1,2,3,4)]
regtabledid1856[c(12,13,14,15),1] <- summary(pois1popn)$coefficients[4,c(1,2,3,4)]
regtabledid1856[17,1] <- summary(pois1popn)$deviance
# Poiss Population density
regtabledid1856[c(1,2,3,4),2] <- summary(pois1popn_den)$coefficients[2,c(1,2,3,4)]
regtabledid1856[c(5,6),2] <- pois1popn_denrobustse[2,c(2,3)]
regtabledid1856[7,2] <- exp(regtabledid1856[1,2])
regtabledid1856[c(8,9,10,11),2] <- summary(pois1popn_den)$coefficients[3,c(1,2,3,4)]
regtabledid1856[c(12,13,14,15),2] <- summary(pois1popn_den)$coefficients[4,c(1,2,3,4)]
regtabledid1856[17,2] <- summary(pois1popn_den)$deviance
regtabledid1856[c(18,19,20,21),2] <- summary(pois1popn_den)$coefficients[5,c(1,2,3,4)]
# Poiss Fixed Effects
regtabledid1856[c(1,2,3,4),3] <- summary(pois2popn)$coefficients[2,c(1,2,3,4)]
regtabledid1856[c(5,6),3] <- pois2popnrobustse[2,c(2,3)]
regtabledid1856[7,3] <- exp(regtabledid1856[1,3])
regtabledid1856[c(8,9,10,11),3] <- summary(pois2popn)$coefficients[3,c(1,2,3,4)]
regtabledid1856[c(12,13,14,15),3] <- summary(pois2popn)$coefficients[4,c(1,2,3,4)]
regtabledid1856[17,3] <- summary(pois2popn)$deviance
# NB no population density
regtabledid1856[c(1,2,3,4),4] <- summary(nb1popn)$coefficients[2,c(1,2,3,4)]
regtabledid1856[c(5,6),4] <- nb1popnrobustse[2,c(2,3)]
regtabledid1856[7,4] <- exp(regtabledid1856[1,3])
regtabledid1856[c(8,9,10,11),4] <- summary(nb1popn)$coefficients[3,c(1,2,3,4)]
regtabledid1856[c(12,13,14,15),4] <- summary(nb1popn)$coefficients[4,c(1,2,3,4)]
regtabledid1856[16,4] <- summary(nb1popn)$theta
regtabledid1856[17,4] <- summary(nb1popn)$deviance
# NB population density & water company percent
regtabledid1856[c(1,2,3,4),5] <- summary(nb1popn_den)$coefficients[2,c(1,2,3,4)]
regtabledid1856[c(5,6),5] <- nb1popn_denrobustse[2,c(2,3)]
regtabledid1856[7,5] <- exp(regtabledid1856[1,5])
regtabledid1856[c(8,9,10,11),5] <- summary(nb1popn_den)$coefficients[3,c(1,2,3,4)]
regtabledid1856[c(12,13,14,15),5] <- summary(nb1popn_den)$coefficients[4,c(1,2,3,4)]
regtabledid1856[16,5] <- summary(nb1popn_den)$theta
regtabledid1856[17,5] <- summary(nb1popn_den)$deviance
regtabledid1856[c(18,19,20,21),5] <- summary(nb1popn_den)$coefficients[5,c(1,2,3,4)]
# NB FEs
regtabledid1856[c(1,2,3,4),6] <- summary(nb2popn)$coefficients[2,c(1,2,3,4)]
regtabledid1856[c(5,6),6] <- nb2popnrobustse[2,c(2,3)]
regtabledid1856[7,6] <- exp(regtabledid1856[1,6])
regtabledid1856[c(8,9,10,11),6] <- summary(nb2popn)$coefficients[3,c(1,2,3,4)]
regtabledid1856[c(12,13,14,15),6] <- summary(nb2popn)$coefficients[4,c(1,2,3,4)]
regtabledid1856[16,6] <- summary(nb2popn)$theta
regtabledid1856[17,6] <- summary(nb2popn)$deviance


```


###Conclusion - Snow was Right - Clean Water Matters

Using the population by sub-district to measure the fraction of customers supplied by the Southwark & Vauxhall Company, the Lambeth Company, and Other (wells etc.) strongly supports Snow's contention both that the actual and predicted mortality "bear a close relation" and that nature of the water supply exerts an "overwhelming influence". 

